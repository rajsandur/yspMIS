json_data = {"data": [{"qid": 1, "qtype": "radio", "ques": {"english": "Does the organization have <b>policy on reduction of harmful work Stress </b> (either exclusive or as part of general health policy)?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 2}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 2}]}, {"qid": 2, "qtype": "radio", "ques": {"english": "Does the workplace have <b>Health/ NCD committee</b> consider work stress in its activities? ", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 3}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 3}]}, {"qid": 3, "qtype": "radio", "ques": {"english": "Is there a <b>designated person</b> to address stress related issues in the organization?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 4}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 4}]}, {"qid": 4, "qtype": "radio", "ques": {"english": "Is there a <b>Stress assessment mechanism </b> among the employees in the organization (it also includes screening for workplace stress)?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 5}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 5}]}, {"qid": 5, "qtype": "radio", "ques": {"english": "Is there a <b>system to review </b> certain key stressors?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 6}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 18}]}, {"qid": 6, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Work Timings</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 7}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 7}]}, {"qid": 7, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Work overload</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 8}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 8}]}, {"qid": 8, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Decision on employee targets</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 9}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 9}]}, {"qid": 9, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Career development and progression (Appraisal systems)</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 10}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 10}]}, {"qid": 10, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Effort-reward mechanisms in-place/b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 11}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 11}]}, {"qid": 11, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Skill training of employees for better performance</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 12}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 12}]}, {"qid": 12, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Role ambiguity of employees</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 13}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 13}]}, {"qid": 13, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Break-timings</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 14}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 14}]}, {"qid": 14, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Social security mechanisms (health insurance, provident fund)</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 15}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 15}]}, {"qid": 15, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Work shift </b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 16}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 16}]}, {"qid": 16, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Work type as per qualification and skill set of employee</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 17}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 17}]}, {"qid": 17, "qtype": "radio", "ques": {"english": "Is there a system to review the stress induced by <b>Grievance re-adressal</b> in your work place?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 18}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 18}]}, {"qid": 18, "qtype": "radio", "ques": {"english": "Is there a <b>Stress Management Programme</b> in the organization?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 19}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 19}]}, {"qid": 19, "qtype": "radio", "ques": {"english": "Is there a <b>budget</b> allocated for activities needed for managing work stress in the organization? ", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 20}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 20}]}, {"qid": 20, "qtype": "radio", "ques": {"english": "Are any <b>identified employees, or staff from HR or health department </b> trained in identifying and managing work related stress?", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [{"aid": 1, "value": "Absent", "value_id": 0, "next_qid": 21}, {"aid": 2, "value": "Present", "value_id": 1, "next_qid": 21}]}, {"qid": 21, "qtype": "num", "ph": "Enter percentage", "ques": {"english": "What is the <b>proportion of workers reporting harmful work stress</b> compiled as an indicator very year", "kannada": ""}, "question_information": -9.0, "section": "Checklist for rapid appraisal of harmful stress related interventions in the industry", "next_qid": 0, "scoring_required": "True", "mandatory": "True", "capture_specifics": "False", "follow_up": "False", "ans": [], "range": 100}],"sections":[{"name":"Checklist for rapid appraisal of harmful stress related interventions in the industry","summary":""}],"heading":"RAPID appraisal of harmful stress"}


var res = []

function validatesection(section){
    
    //alert(section)
    var data_payload = []
    starting_question_idx=0;
    ending_question_idx=0;
    breakflag=false;
    for(var i=0; i<json_data.data.length; i++){
        
        //alert(json_data.data[i].qid)
        if (json_data.data[i].section == section){
            if(starting_question_idx==0){
                 //starting_question=json_data.data[i].qid
                 starting_question_idx=i
                 breakflag=true
            }
             
        }else if(breakflag==true){
            ending_question_idx=i-1
            //ending_question=json_data.data[i-1].qid
            break
        }     
        
    } 
    
    var enterdata=[]
    var selectdata=[]
    document.getElementById(section+'_msg1').innerHTML = ''
    
   // alert("starting_question_idx"+starting_question_idx)
    //alert("starting_question_idx"+ending_question_idx)
    //Iterate through section questions
    for(var i=starting_question_idx-1; i<=ending_question_idx; i++){
        
        var ques_type = json_data.data[i].qtype

		if(json_data.data[i].mandatory == "True"){
			if(ques_type == 'text'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})
               // alert((json_data.data[i].qid).toString()+':text:'+val)
				if(val.length == 0){
					enterdata.push(json_data.data[i].qid)
                    document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "red"
                    //flag = 1
				}else{
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "black"
                }
			}else if(ques_type == 'num'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})
                //alert((json_data.data[i].qid).toString()+':num:'+val)
				if(val =='' || parseInt(val) < 0 || parseInt(val) == NaN){
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "red"
					enterdata.push(json_data.data[i].qid)
                    //flag = 2
				}else{
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "black"
                }
			}else if(ques_type == 'date'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})
                //alert((json_data.data[i].qid).toString()+':date:'+val)
				if(val.length == 0){
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "red"
					enterdata.push(json_data.data[i].qid)
                    //flag = 3
				}else{
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "black"
                }
			}else if(ques_type == 'radio' || ques_type == 'f_radio'){
				
				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': json_data.data[i].selection_val})

				//console.log(json_data.data[i].selection_val)
                //alert((json_data.data[i].qid).toString()+':radio:'+val)
				if(json_data.data[i].selection_val == undefined || json_data.data[i].selection_val.length == 0){
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "red"
					selectdata.push(json_data.data[i].qid)
                    //flag = 5
				}else{
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "black"
                }

			}else if(ques_type == 'options'){
				
				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': json_data.data[i].selection_val})

				//console.log(json_data.data[i].selection_val)
                // alert((json_data.data[i].qid).toString()+':options:'+val)
				if(json_data.data[i].selection_val == undefined || json_data.data[i].selection_val.length == 0){
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "red"
					selectdata.push(json_data.data[i].qid)
                    //flag = 4
				}else{
                     document.getElementById('q_'+json_data.data[i].qid+'_q').style.color = "black"
                }

			}
		}else{
			if(ques_type == 'text'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

			}else if(ques_type == 'num'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				//data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

			}
		}
        
    }
    
    enterquestions=''
    selectquestion=''
    message=''
    for(var i=0;i<enterdata.length;i++){
        
       // alert('enter'+i)
        enterquestions=enterquestions+'-'+enterdata[i].toString()
        //alert('enter'+enterdata[i])
    }
    
    for(var i=0;i<selectdata.length;i++){
        // alert('enter'+i)
         selectquestion=selectquestion+'-'+selectdata[i].toString()
        //alert('select'+selectdata[i])
    }
    
    if(enterquestions!=''){
        
        //alert('Please enter right information for questions '+enterquestions)
        message = 'Please enter right information for questions '+enterquestions
        document.getElementById(section+'_msg1').innerHTML = 'Please enter right information for questions '+enterquestions
    }
    
    if(selectquestion!=''){
        
        //alert('Please select right information for questions '+selectquestion)
        document.getElementById(section+'_msg2').innerHTML = 'Please select right information for questions '+selectquestion
    }
    
     if(enterquestions ==''&& selectquestion==''){
        
        //alert("Thanks for entering all details. Please move down to next section")
        document.getElementById(section+'_msg1').style.display = 'none'
        document.getElementById(section+'_msg2').style.display = 'none'
        document.getElementById(section+'_msg3').innerHTML="Thanks for entering all details. Please move down to next section"
    }
    //mandatory, it should have data or be selected.
    // Set the selected value
    
    //alert(starting_question_idx-1)
    //alert(ending_question_idx)
}

function select_radio(qid, element_id){

	var radio_element = document.getElementById('q'+qid+'_'+element_id)

	var element_count = json_data.data[parseInt(qid)-1]['ans'].length
    
    //alert(qid)
    //alert(element_id)

	json_data.data[parseInt(qid)-1].selection_val = parseInt(element_id)

	for(var i=0; i<element_count; i++){
		if((i+1) != parseInt(element_id)){
			var ele = document.getElementById('q'+qid+'_'+(i+1).toString())
			ele.classList.remove("btn-rose")
		}
	}

	radio_element.classList.add("btn-rose")
    

	//If the option selected for question 5 is Absent (option 2) ,then the user should skip to question 18
    if(parseInt(qid) == 5 ){
        
        new_qid_i=parseInt(qid) + 1
        new_qid = (parseInt(qid) + 1).toString()
        last_question_i=17
        last_question=last_question_i.toString()
		
        //If the selected option is Present (2nd option). Else, it should skip the next question few questions
		if(parseInt(element_id) == 2){
			 for(var i=new_qid_i; i<=last_question_i; i++){
			     new_qid=parseInt(i).toString()
                 document.getElementById('q_'+new_qid+'_q').style.display = 'block'
      		     document.getElementById('q_'+new_qid+'_ig').style.display = 'block'
            }
		}else{
			for(var i=new_qid_i; i<=last_question_i; i++){
			     new_qid=parseInt(i).toString()
                 document.getElementById('q_'+new_qid+'_q').style.display = 'none'
      		     document.getElementById('q_'+new_qid+'_ig').style.display = 'none'

      		     json_data.data[parseInt(new_qid)-1].selection_val = parseInt(element_id)
            }
		}
	}
}

function calculate_score(){

	
    total_score=0

	//work_stress_ques = 14 - 45
	//symptoms_ques = 46 - 61

	for(var i=0; i<20; i++){
        //alert(i)
		if("selection_val" in json_data.data[i] && json_data.data[i].scoring_required == "True"){
			aid = parseInt(json_data.data[i].selection_val)
			total_score += parseInt(json_data.data[i].ans[aid - 1].value_id)
            
		}
	}

	//for(var i=45; i<61; i++){
	//	if("selection_val" in json_data.data[i] && json_data.data[i].scoring_required == "true"){
	//		aid = parseInt(json_data.data[i].selection_val)
	//		symptoms_score += parseInt(json_data.data[i].ans[aid - 1].value_id)
	//	}
	//}

	console.log(total_score)

	msgs = {"ncd_rapid": total_score}

	/*if(work_stress_score <= 48){
		msgs.work_stress = work_stress_msg[0].msg
	}else if(work_stress_score > 48 && work_stress_score <= 59){
		msgs.work_stress = work_stress_msg[1].msg
	}else if(work_stress_score > 59 && work_stress_score <= 73){
		msgs.work_stress = work_stress_msg[2].msg
	}else if(work_stress_score > 73){
		msgs.work_stress = work_stress_msg[3].msg
	}

	if(symptoms_score <= 16){
		msgs.symptoms = symptoms_msg[0].msg
	}else if(symptoms_score > 16 && symptoms_score <= 29){
		msgs.symptoms = symptoms_msg[1].msg
	}else if(symptoms_score > 29 && symptoms_score <= 36){
		msgs.symptoms = symptoms_msg[2].msg
	}else if(symptoms_score > 36){
		msgs.symptoms = symptoms_msg[3].msg
	}*/

	return msgs

}


function on_submit(){
	var flag = 0

	var data_payload = []

	for(var i=0; i<json_data.data.length; i++){
		
		var ques_type = json_data.data[i].qtype

		
		if(json_data.data[i].mandatory == "True"){
			if(ques_type == 'text'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

				if(val.length == 0){
					flag = 1
				}
			}else if(ques_type == 'num'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

				if(parseInt(val) < 0 || parseInt(val) == NaN){
					flag = 2
				}
			}else if(ques_type == 'date'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

				if(val.length == 0){
					flag = 3
				}
			}else if(ques_type == 'radio'){
				
				data_payload.push({'qid': json_data.data[i].qid, 'selection_val': json_data.data[i].selection_val})

				//console.log(json_data.data[i].selection_val)

				if(json_data.data[i].selection_val == undefined || json_data.data[i].selection_val.length == 0){
					flag = 5
				}

			}
		}else{
			if(ques_type == 'text'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

			}else if(ques_type == 'num'){
				var val = document.getElementById('q_'+(json_data.data[i].qid).toString()+'_data').value

				json_data.data[i].selection_val = val

				data_payload.push({'qid': json_data.data[i].qid, 'selection_val': val})

			}
		}

	}

	if(flag == 0){

		var scores = calculate_score()

		//localStorage.setItem('_stress_app_user_name', data_payload[0].selection_val)
		//localStorage.setItem('_stress_app_work_stress_msg', scores.work_stress)
		localStorage.setItem('_ncd_rapid_msg', scores.ncd_rapid)
		//alert(scores.ncd_rapid)
		document.getElementById('done_spinner').style.display = 'block'

		var xhttp = new XMLHttpRequest();
	    xhttp.onreadystatechange = function() {
	        if (this.readyState == 4 && this.status == 200) {
	          //console.log(this.responseText);
	          window.location.href = '/ncdrapid_score'
	        }
	    };
	    xhttp.open("POST", "/add_ncdrapid_assessment", true);
	    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	    xhttp.send('data='+encodeURIComponent(JSON.stringify(data_payload)));

	    console.log(JSON.stringify(data_payload))

	}else if(flag == 1){
		alert('Please answer all the text questions')
	}else if(flag == 2){
		alert('Please answer all the numeric questions')
	}else if(flag == 3){
		alert('Please answer all the date questions')
	}else if(flag == 4){
		alert('Please answer all the selection questions')
	}else if(flag == 5){
		alert('Please answer all the questions')
	}else if(flag == 6){
		alert('Please answer all the checkbox questions')
	}
    
}